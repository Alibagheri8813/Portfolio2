{% if GA_MEASUREMENT_ID %}
<script>
  (function(){
    const GA_ID = "{{ GA_MEASUREMENT_ID }}";
    function loadGA(){
      if(!GA_ID) return;
      if(window.__gaLoaded) return;
      window.__gaLoaded = true;
      const s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
      document.head.appendChild(s);
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', GA_ID, { anonymize_ip: true });
    }
    if(localStorage.getItem('consent') === 'true'){ loadGA(); }
    window.enableAnalytics = loadGA;
  })();
</script>
{% endif %}